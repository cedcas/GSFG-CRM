function cV(){function cT(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return('k'+cT()+cT()+cT()+cT()+cT()+cT()+cT());};Ext.namespace('KINAMU.kreports');KINAMU.kreports.kreportsJsonStore=Ext.extend(Ext.data.JsonStore,{domElement:'',constructor:function(config){KINAMU.kreports.kreportsJsonStore.superclass.constructor.call(this,config);},loadData:function(o,append){KINAMU.kreports.kreportsJsonStore.superclass.loadData.call(this,o,append);},writeJson:function(){jArray=new Array();if(this.isFiltered()){for(i=0;i<this.snapshot.items.length;i++){jArray.push(Ext.util.JSON.encode(this.snapshot.items[i].data));}}else{for(i=0;i<this.data.items.length;i++){jArray.push(Ext.util.JSON.encode(this.data.items[i].data));}}document.getElementById(this.domElement).value='['+jArray.toString()+']';},loadDirect:function(){if(document.getElementById(this.domElement).value!='')this.loadData(Ext.util.JSON.decode(document.getElementById(this.domElement).value));},add:function(records){KINAMU.kreports.kreportsJsonStore.superclass.add.call(this,records);this.writeJson();},remove:function(record){KINAMU.kreports.kreportsJsonStore.superclass.remove.call(this,record);this.writeJson();},afterEdit:function(record){KINAMU.kreports.kreportsJsonStore.superclass.afterEdit.call(this,record);this.writeJson();},getMaxSequence:function(){var maxSequence=0;var i=0;while(i<this.getCount()){if(this.getAt(i).data.sequence>maxSequence)maxSequence=this.getAt(i).data.sequence;i++;}return parseInt(maxSequence,10);},getNextSequence:function(){cc=this.getMaxSequence()+1;if(cc<10)cc='0'+cc;return cc;}});var F=new Ext.data.JsonStore({fields:[{name:'lblid',type:'string'},{name:'value',type:'string'}]});if(document.getElementById('jsonlanguage').value!=''){var jsonLanguage;eval("jsonLanguage = "+document.getElementById('jsonlanguage').value);F.loadData(Ext.util.JSON.decode(document.getElementById('jsonlanguage').value));}var l=function(M){var recordNumber=F.find('lblid',M);if(recordNumber>=0){return F.getAt(recordNumber).data.value;}else{return M;}};Ext.namespace('KINAMU.kreports.mainEditToolbar');KINAMU.kreports.mainEditToolbar.username=new Ext.form.ComboBox({store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_userids&to_pdf=true'}),reader:new Ext.data.JsonReader({root:'data',totalProperty:'count','fields':[{name:'value'},{name:'text'}]})}),displayField:'text',valueField:'value',forceSelection:true,typeAhead:false,loadingText:l('LBL_SEARCHING'),width:100,listWidth:200,pageSize:10,hideTrigger:false,triggerAction:'all',initializeFromForm:function(){this.setValue(document.getElementById('assigned_user_name').value);},listeners:{select:function(combo,record){document.getElementById('assigned_user_id').value=record.get('value');},beforerender:function(){this.initializeFromForm();}}});KINAMU.kreports.mainEditToolbar.reportname=new Ext.form.TextField({width:130,listeners:{beforerender:function(){if(document.getElementById('name').value!='')this.setValue(document.getElementById('name').value);else this.setValue(l('LBL_DEFAULT_NAME'));},change:function(){document.getElementById('name').value=this.getValue();}}});KINAMU.kreports.mainEditToolbar.authCheckFull=new Ext.menu.CheckItem({text:l('LBL_AUTH_FULL'),group:'authCheck',id:'authcheck_full',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.authCheckTop=new Ext.menu.CheckItem({text:l('LBL_AUTH_TOP'),group:'authCheck',id:'authcheck_top',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.authCheckNone=new Ext.menu.CheckItem({text:l('LBL_AUTH_NONE'),group:'authCheck',id:'authcheck_none',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.showDeleted=new Ext.menu.CheckItem({text:l('LBL_SHOW_DELETED'),id:'show_deleted',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.testCheck=new Ext.menu.CheckItem({text:l('LBL_DYNOPTIONS_FOLDED'),id:'test_check',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.dynamicOptionsFolded=new Ext.menu.CheckItem({text:l('LBL_DYNOPTIONS_FOLDED'),group:'dynOptions',id:'dynoptions_folded',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.dynamicOptionsUnfolded=new Ext.menu.CheckItem({text:l('LBL_DYNOPTIONS_UNFOLDED'),group:'dynOptions',id:'dynoptions_unfolded',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.resultsFolded=new Ext.menu.CheckItem({text:l('LBL_RESULTS_FOLDED'),group:'resultsFolded',id:'results_folded',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.resultsUnfolded=new Ext.menu.CheckItem({text:l('LBL_RESULTS_UNFOLDED'),group:'resultsFolded',id:'results_unfolded',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.showExport=new Ext.menu.CheckItem({text:l('LBL_SHOW_EXPORT'),id:'show_export',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.showSnapshots=new Ext.menu.CheckItem({text:l('LBL_SHOW_SNAPSHOTS'),id:'show_snapshots',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.showTools=new Ext.menu.CheckItem({text:l('LBL_SHOW_TOOLS'),id:'show_tools',checkHandler:function(thisElement){KINAMU.kreports.mainEditToolbar.setValues();}});KINAMU.kreports.mainEditToolbar.reportOptions=new Ext.menu.Menu({style:{overflow:'visible'},items:[{text:l('LBL_AUTH_CHECK'),icon:'modules/KReports/images/listlimit.png',menu:{items:[KINAMU.kreports.mainEditToolbar.authCheckFull,KINAMU.kreports.mainEditToolbar.authCheckTop,KINAMU.kreports.mainEditToolbar.authCheckNone,'-',KINAMU.kreports.mainEditToolbar.showDeleted]}},{text:l('LBL_FOLDED_PANELS'),icon:'modules/KReports/images/listlimit.png',menu:{items:[KINAMU.kreports.mainEditToolbar.dynamicOptionsFolded,KINAMU.kreports.mainEditToolbar.dynamicOptionsUnfolded,'-',KINAMU.kreports.mainEditToolbar.resultsFolded,KINAMU.kreports.mainEditToolbar.resultsUnfolded]}},{text:l('LBL_OPTIONS_MENUITEMS'),icon:'modules/KReports/images/listlimit.png',menu:{items:[KINAMU.kreports.mainEditToolbar.showExport,KINAMU.kreports.mainEditToolbar.showSnapshots,KINAMU.kreports.mainEditToolbar.showTools]}}]});if(l('report_status_options')!=''){eval('KINAMU.kreports.mainEditToolbar.statusComboOptions = '+Ext.util.Format.htmlDecode(l('report_status_options')));}else KINAMU.kreports.mainEditToolbar.statusComboOptions=[];KINAMU.kreports.mainEditToolbar.statusCombo=new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({fields:['key','displayText'],data:KINAMU.kreports.mainEditToolbar.statusComboOptions}),valueField:'key',displayField:'displayText',listeners:{beforerender:function(){if(document.getElementById('report_status').value!='')this.setValue(document.getElementById('report_status').value);},change:function(){document.getElementById('report_status').value=this.getValue();}}});KINAMU.kreports.mainEditToolbar.getValues=function(){optionsObject=Ext.util.JSON.decode(document.getElementById('reportoptions').value);switch(optionsObject.authCheck){case 'none':if(!KINAMU.kreports.mainEditToolbar.authCheckNone.checked)KINAMU.kreports.mainEditToolbar.authCheckNone.setChecked(true,true);break;case 'top':if(!KINAMU.kreports.mainEditToolbar.authCheckTop.checked)KINAMU.kreports.mainEditToolbar.authCheckTop.setChecked(true,true);break;default:if(!KINAMU.kreports.mainEditToolbar.authCheckFull.checked)KINAMU.kreports.mainEditToolbar.authCheckFull.setChecked(true,true);break;}if(optionsObject.showDeleted!=undefined&&optionsObject.showDeleted==true)KINAMU.kreports.mainEditToolbar.showDeleted.setChecked(true,true);else KINAMU.kreports.mainEditToolbar.showDeleted.setChecked(false,true);if(optionsObject.optionsFolded==undefined||optionsObject.optionsFolded==false)KINAMU.kreports.mainEditToolbar.dynamicOptionsUnfolded.setChecked(true,true);else KINAMU.kreports.mainEditToolbar.dynamicOptionsFolded.setChecked(true,true);if(optionsObject.resultsFolded)KINAMU.kreports.mainEditToolbar.resultsFolded.setChecked(true,true);else KINAMU.kreports.mainEditToolbar.resultsUnfolded.setChecked(true,true);if(optionsObject.showExport==undefined||optionsObject.showExport==false)KINAMU.kreports.mainEditToolbar.showExport.setChecked(false,true);else KINAMU.kreports.mainEditToolbar.showExport.setChecked(true,true);if(optionsObject.showSnapshots==undefined||optionsObject.showSnapshots==false)KINAMU.kreports.mainEditToolbar.showSnapshots.setChecked(false,true);else KINAMU.kreports.mainEditToolbar.showSnapshots.setChecked(true,true);if(optionsObject.showTools==undefined||optionsObject.showTools==false)KINAMU.kreports.mainEditToolbar.showTools.setChecked(false,true);else KINAMU.kreports.mainEditToolbar.showTools.setChecked(true,true);};KINAMU.kreports.mainEditToolbar.setValues=function(){optionsArray=new Object();if(KINAMU.kreports.mainEditToolbar.resultsUnfolded.checked==true)optionsArray.resultsFolded=false;if(KINAMU.kreports.mainEditToolbar.resultsFolded.checked==true)optionsArray.resultsFolded=true;if(KINAMU.kreports.mainEditToolbar.dynamicOptionsUnfolded.checked==true)optionsArray.optionsFolded=false;if(KINAMU.kreports.mainEditToolbar.dynamicOptionsFolded.checked==true)optionsArray.optionsFolded=true;if(KINAMU.kreports.mainEditToolbar.authCheckFull.checked==true)optionsArray.authCheck='full';if(KINAMU.kreports.mainEditToolbar.authCheckTop.checked==true)optionsArray.authCheck='top';if(KINAMU.kreports.mainEditToolbar.authCheckNone.checked==true)optionsArray.authCheck='none';if(KINAMU.kreports.mainEditToolbar.showDeleted.checked)optionsArray.showDeleted=true;else optionsArray.showDeleted=false;if(KINAMU.kreports.mainEditToolbar.showExport.checked)optionsArray.showExport=true;else optionsArray.showExport=false;if(KINAMU.kreports.mainEditToolbar.showSnapshots.checked)optionsArray.showSnapshots=true;else optionsArray.showSnapshots=false;if(KINAMU.kreports.mainEditToolbar.showTools.checked)optionsArray.showTools=true;else optionsArray.showTools=false;document.getElementById('reportoptions').value=Ext.util.JSON.encode(optionsArray);};KINAMU.kreports.mainEditToolbar.reportOptions.on('show',function(){KINAMU.kreports.mainEditToolbar.getValues();});KINAMU.kreports.mainEditToolbar.descriptionTextArea=new Ext.form.TextArea({});KINAMU.kreports.mainEditToolbar.descriptionPopupwin=new Ext.Window({layout:'fit',width:500,height:300,closeAction:'hide',plain:true,title:'Description',items:KINAMU.kreports.mainEditToolbar.descriptionTextArea,listeners:{hide:function(){document.getElementById('description').value=KINAMU.kreports.mainEditToolbar.descriptionTextArea.getValue();}}});KINAMU.kreports.mainEditToolbar.Toolbar=new Ext.Toolbar({renderTo:'toolbarArea',items:[{text:l('LBL_SAVE_BUTTON_LABEL'),icon:'modules/KReports/images/save.png',handler:function(){var form=document.getElementById('EditView');form.action.value='Save';form.submit();},disabled:false},{text:l('LBL_CANCEL_BUTTON_LABEL'),icon:'modules/KReports/images/cancel.png',handler:function(){var form=document.getElementById('EditView');if(form.record.value=='')form.action.value='index';else form.action.value='DetailView';form.module.value='KReports';form.submit();},disabled:false},'-',{xtype:'tbtext',text:l('LBL_REPORT_NAME_LABEL')},KINAMU.kreports.mainEditToolbar.reportname,{icon:'modules/KReports/images/longtext.png',handler:function(){KINAMU.kreports.mainEditToolbar.descriptionTextArea.setValue(document.getElementById('description').value);KINAMU.kreports.mainEditToolbar.descriptionPopupwin.show();},disabled:false},'-',KINAMU.kreports.mainEditToolbar.statusCombo,'-',{xtype:'tbtext',text:l('LBL_ASSIGNED_USER_LABEL')},' ',KINAMU.kreports.mainEditToolbar.username,'-',{text:l('LBL_REPORT_OPTIONS'),icon:'modules/KReports/images/tools.png',menu:KINAMU.kreports.mainEditToolbar.reportOptions},]});var m=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_enum&to_pdf=true'}),reader:new Ext.data.JsonReader({'fields':[{name:'value'},{name:'text'}]})});var aS=new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:m,displayField:'text'});var as=[['ignore',0],['equals',1],['notequal',1],['greater',1],['greaterequal',1],['less',1],['lessequal',1],['starts',1],['notstarts',1],['contains',1],['notcontains',1],['between',2],['isempty',0],['isnotempty',0]];var ay=[['ignore',0],['equals',1],['notequal',1],['greater',1],['greaterequal',1],['less',1],['lessequal',1],['between',2],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aA=[['ignore',0],['equals',1],['notequal',1],['oneof',1],['oneofnot',1],['oneofnotornull',1],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aB=[['ignore',0],['equals',1],['notequal',1],['before',1],['after',1],['between',2],['thismonth',0],['next3month',0],['lastmonth',0],['last3month',0],['thisyear',0],['lastyear',0],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aG=[['ignore',0],['equals',1],['notequal',1],['isemptyornull',0],['isnull',0]];var whereOperatorsFields=[{name:'operator'},{name:'values',type:'float'},{name:'display'}];var af=new Ext.data.ArrayStore({fields:whereOperatorsFields});var aH=function(){var V=function(record){record.set('display',l('LBL_OP_'+record.data.operator.toUpperCase()));};af.each(V);};var av=function(ap){af.removeAll();switch(ap){case 'date':case 'datetime':case 'datetimecombo':af.loadData(aB);break;case 'id':case 'varchar':case 'text':case 'name':af.loadData(as);break;case 'int':case 'double':case 'float':case 'currency':af.loadData(ay);break;case 'bool':af.loadData(aG);break;case 'enum':case 'multienum':case 'user_name':case 'assigned_user_name':af.loadData(aA);break;}aH();};var aE=function(aQ,ap){av(ap);var aw=af.find('operator',aQ);if(aw>=0){return af.getAt(aw).data.values;}else{return 0;}};var B;var J;var R;var aF=function(e,ag,ah){if(ag.getColumnId(e.column)=='value'||ag.getColumnId(e.column)=='valueto'){var ax=aE(e.record.data.operator,e.record.data.type);if(ax===0||(ag.getColumnId(e.column)=='valueto'&&ax!=2)){ah.getColumnModel().setEditor(null);}else{switch(e.record.data.type){case 'datetime':ah.getColumnModel().setEditor(e.column,new Ext.form.DateField({format:cal_date_format.replace(/%/g,'')}));break;case 'date':ah.getColumnModel().setEditor(e.column,new Ext.form.DateField({format:cal_date_format.replace(/%/g,'')}));break;case 'user_name':case 'assigned_user_name':case 'enum':case 'multienum':m.removeAll();m.setBaseParam('path',e.record.data.path);m.load();switch(e.record.data.operator){case('oneof'):var at=new Ext.grid.GridPanel({store:m,columns:[{id:'text',header:l('LBL_MULTISELECT_VALUE_HEADER'),hidden:true},{id:'value',header:l('LBL_MULTISELECT_TEXT_HEADER')}],stripeRows:true,autoExpandColumn:'value',height:350,width:600});m.on('load',function(){var I=B.record.data.valuekey.split(',');for(var i=0;i<I.length;i++){var G=m.find('value',I[i]);if(G!= -1){at.getSelectionModel().selectRow(G,true);}}});B=e;J=ah;R=ag;var win=new Ext.Window({title:l('LBL_MUTLISELECT_POPUP_TITLE'),layout:'fit',width:500,height:300,closeAction:'hide',plain:true,draggable:true,modal:true,items:at,buttons:[{text:l('LBL_MUTLISELECT_CANCEL_BUTTON'),handler:function(){win.hide();}},{text:l('LBL_MUTLISELECT_CLOSE_BUTTON'),handler:function(){win.hide();var aa=at.getSelectionModel();var selectedRows=aa.getSelections();var newValue='';var an='';for(var i=0,O=selectedRows.length;i<O;i++){if(newValue!=''){newValue+=', ';}newValue+=selectedRows[i].data.text;if(an!=''){an+=',';}an+=selectedRows[i].data.value;}B.record.set('value',newValue);B.record.set('valuekey',an);J.fireEvent('afteredit',B);}}]});win.show(this);break;default:ah.getColumnModel().setEditor(e.column,new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:m,displayField:'text',valueField:'value'}));break;}break;default:ah.getColumnModel().setEditor(e.column,new Ext.form.TextField());break;}}}if(ag.getColumnId(e.column)=='operator'){av(e.record.data.type);ah.getColumnModel().setEditor(e.column,new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:af,displayField:'display',valueField:'operator'}));}};var aI=function(e,ag){if(ag.getColumnId(e.column)=='value'||ag.getColumnId(e.column)=='valueto'){switch(e.record.data.type){case 'datetime':e.record.set(ag.getColumnId(e.column),e.value.format('Y-m-d H:i:s'));break;case 'date':e.record.set(ag.getColumnId(e.column),e.value.format('Y-m-d H:i:s'));break;case 'user_name':case 'assigned_user_name':case 'enum':switch(e.record.data.operator){case('oneof'):break;default:e.record.set(ag.getColumnId(e.column)+'key',e.value);e.record.set(ag.getColumnId(e.column),m.getAt(m.find('value',e.value)).data.text);break;}break;default:break;}}if(ag.getColumnId(e.column)=='operator'){if(e.originalValue!=e.value){if(af.getAt(af.find('operator',e.originalValue)).data.values!=af.getAt(af.find('operator',e.value)).data.values||(e.value.indexOf('oneof')!=e.originalValue.indexOf('oneof'))){switch(af.getAt(af.find('operator',e.value)).data.values){case 0:e.record.set('value','---');e.record.set('valueto','---');e.record.set('valuekey','');e.record.set('valuetokey','');break;case 2:e.record.set('value','');e.record.set('valueto','');e.record.set('valuekey','');e.record.set('valuetokey','');break;default:e.record.set('value','');e.record.set('valueto','---');e.record.set('valuekey','');e.record.set('valuetokey','');}}}}};function cf(){if(!ef.collapsed){return 'root';}else{return KINAMU.kreports.dI.cI(null);}};var bJ=[{name:'unionid',mapping:'unionid'},{name:'id',mapping:'id'},{name:'group',mapping:'group'},{name:'type',mapping:'type'},{name:'parent',mapping:'parent'},{name:'notexists',mapping:'notexists'}];var ad=new KINAMU.kreports.kreportsJsonStore({fields:bJ,domElement:'wheregroups',idProperty:'id'});var updatewheregroupfield_xx=function(store){var wheregroups='[';function cW(record){if(record.data.unionid==undefined||record.data.unionid=='')record.data.unionid='root';if(wheregroups!='['){wheregroups+=',';}wheregroups+=Ext.util.JSON.encode(record.data);};ad.each(cW);wheregroups+=']';document.getElementById('wheregroups').value=wheregroups;};var aY=new Ext.tree.TreeNode({text:"root",selected:true,leaf:false,draggable:false,id:"root"});var currentNode=aY;var cj=function(){aY.removeAll();bM(aY,'root');bK(aY);};var bM=function(bY,nodeid){ad.filter('unionid',cf());if(nodeid!='root'){bP=ad.getAt(ad.find('id',nodeid));var aZ=bY.appendChild(new Ext.tree.TreeNode({text:bP.data.group,id:bP.data.id,selected:true,draggable:false}));}else{by=ad.find('id','root');if(by== -1){bR(aY);}var aZ=aY;}ad.filter([{property:'parent',value:nodeid},{property:'unionid',value:cf()}]);var addChild=function(record){bM(aZ,record.id);};ad.each(addChild);ad.clearFilter();};var bR=function(aZ){var bQ=Ext.data.Record.create(bJ);if(aZ.id!='root'){var bF=new bQ({unionid:cf(),id:aZ.id,group:aZ.text,parent:aZ.parentNode.id,type:'AND'});bF.id=aZ.id;}else{var bF=new bQ({unionid:cf(),id:aZ.id,group:aZ.text,parent:'-',type:'AND'});}ad.add(bF);};var cD=function(id,ap){var aX=ad.find('id',id);if(aX!= -1){var ba=ad.getAt(aX);ba.set('type',ap);}};var cz=function(id,cb){var aX=ad.find('id',id);if(aX!= -1){var ba=ad.getAt(aX);if(cb){ba.set('notexists','1');}else{ba.set('notexists','');}}};var cC=function(id,bZ){var aX=ad.find('id',id);if(aX!= -1){var ba=ad.getAt(aX);ba.set('group',bZ);}};var cB=new Ext.Button({text:l('LBL_ADD_BUTTON_LABEL'),icon:'modules/KReports/images/link_add.png',handler:function(){Ext.Msg.prompt(l('LBL_ADD_GROUP_NAME'),l('LBL_CHANGE_GROUP_NAME_PROMPT'),function(f,text){if(f=='ok'){var bX=currentNode.appendChild(new Ext.tree.TreeNode({id:cV(),text:text,selected:true,draggable:false}));bR(bX);bA.disable();}});}});var bA=new Ext.Button({text:l('LBL_DELETE_BUTTON_LABEL'),icon:'modules/KReports/images/link_delete.png',handler:function(){currentNode.remove();},disabled:true});var bw=new Ext.Button({text:l('LBL_EDIT_BUTTON_LABEL'),icon:'modules/KReports/images/link_edit.png',handler:function(){Ext.Msg.prompt(l('LBL_CHANGE_GROUP_NAME'),l('LBL_CHANGE_GROUP_NAME_PROMPT'),function(f,text){if(f=='ok'){cC(currentNode.id,text);currentNode.setText(text);}});},disabled:true});var bs=new Ext.form.ComboBox({store:['AND','OR'],name:'group Clause',typeAhead:true,editable:false,mode:'local',triggerAction:'all',emptyText:'Select a type.',aR:true,value:'AND',width:50});bs.on('select',function(){cD(currentNode.id,bs.value);});var cA=new Ext.form.Label({text:l('LBL_SELECTION_CLAUSE')});var bt=new Ext.form.Checkbox({boxLabel:'where Exists',name:'where Exists Checkbox'});bt.on('check',function(){cz(currentNode.id,bt.checked);});var bK=function(n){ai.clearFilter(true);if(n.parentNode!=null){if(n.hasChildNodes()||ai.find('groupid',n.id)!= -1){bA.disable();}else{bA.enable();}bw.enable();currentNode=n;}else{bA.disable();bw.disable();currentNode=n;}var aX=ad.find('id',currentNode.id);if(aX!= -1){var ba=ad.getAt(aX);bs.setValue(ba.data.type);if(ba.data.notexists=='1'){bt.setValue(true);}else{bt.setValue(false);}}ai.filter([{property:'groupid',value:currentNode.id},{property:'unionid',value:cf()}])};var bb=new Ext.tree.TreePanel({id:'wheretreepanel',split:true,flex:50,width:250,minSize:100,autoScroll:true,rootVisible:true,lines:false,singleExpand:true,useArrows:true,enableDragDrop:false,root:aY,listeners:{click:bK},tbar:new Ext.Toolbar({items:[cB,bA,bw,{xtype:'tbseparator'},cA,{xtype:'tbspacer',width:10},bs]})});var cn=function(n){n.destroy();};var bW=function(){bb.root.eachChild(cn);};KINAMU.kreports.aO=[{name:'unionid',mapping:'unionid'},{name:'sequence',mapping:'sequence'},{name:'fieldid',mapping:'fieldid'},{name:'name',mapping:'name'},{name:'groupid',mapping:'groupid'},{name:'path',mapping:'path'},{name:'displaypath',mapping:'displaypath'},{name:'referencefieldid',mapping:'referencefieldid'},{name:'operator',mapping:'operator'},{name:'type',mapping:'type'},{name:'value',mapping:'value'},{name:'valuekey',mapping:'valuekey'},{name:'valueto',mapping:'valueto'},{name:'valuetokey',mapping:'valuetokey'},{name:'jointype',mapping:'jointype'},{name:'include',mapping:'include'},{name:'usereditable',mapping:'usereditable'}];var ai=new KINAMU.kreports.kreportsJsonStore({fields:KINAMU.kreports.aO,domElement:'whereconditions',paramsAsHash:true});var ag=new Ext.grid.ColumnModel([{header:l('LBL_FIELDNAME'),readOnly:true,dataIndex:'displaypath',width:150,sortable:true,hidden:false},{id:'sequence',header:l('LBL_SEQUENCE'),dataIndex:'sequence',sortable:true,editor:new Ext.form.TextField(),width:80},{id:'name',header:l('LBL_NAME'),dataIndex:'name',sortable:true,editor:new Ext.form.TextField(),width:150},{id:'type',header:l('LBL_TYPE'),dataIndex:'type',sortable:false,hidden:true,width:50},{id:'operator',header:l('LBL_OPERATOR'),readOnly:true,dataIndex:'operator',width:150,sortable:true,hidden:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){return l('LBL_OP_'+value.toUpperCase());},editor:new Ext.form.TextField()},{id:'value',header:l('LBL_VALUE_FROM'),dataIndex:'value',sortable:true,hidden:false,width:150,editor:new Ext.form.TextField()},{id:'valueto',header:l('LBL_VALUE_TO'),dataIndex:'valueto',sortable:true,hidden:false,width:150,editor:new Ext.form.TextField()},{header:l('LBL_JOIN_TYPE'),readOnly:true,dataIndex:'jointype',width:150,sortable:true,hidden:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){return value;},editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['jointype'],data:[['required'],['notexisting']]}),displayField:'jointype'})},{header:l('LBL_USEREDITABLE'),readOnly:true,dataIndex:'usereditable',width:80,sortable:true,hidden:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){return value;},editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['editable'],data:[['yes'],['no']]}),displayField:'editable'})}]);var ah=new Ext.grid.EditorGridPanel({ddGroup:'whereGridDDGroup',store:ai,cm:ag,flex:100,clicksToEdit:1,enableDragDrop:true,stripeRows:true,autoExpandColumn:'name',width:325,tbar:new Ext.Toolbar({items:[{text:l('LBL_DELETE_BUTTON_LABEL'),icon:'modules/KReports/images/delete.png',handler:function(){var aV=ah.getSelectionModel().getSelectedCell();ai.removeAt(aV[0]);ai.filter('groupid',bb.getSelectionModel().getSelectedNode().id);if(ai.getTotalCount>0||bb.getSelectionModel().getSelectedNode().parentNode===null){bA.disable();}else{bA.enable();}}}]})});ah.on('beforeedit',function(e){aF(e,ag,ah);});ah.on('afteredit',function(e){aI(e,ag);});KINAMU.kreports.cy=new Ext.Panel({title:l('LBL_WHERRE_CLAUSE_TITLE'),width:325,collapsed:true,layout:'vbox',layoutConfig:{align:'stretch',pack:'start'},items:[bb,ah]});var standardGridPropertiesCountSynchronous=new Ext.form.Radio({itemId:'standardGridPropertiesCountSynchronous',boxLabel:l('LBL_STANDARDGRIDPROPERTIES_SYNCHRONOUSCOUNT'),name:'syncCount',inputValue:1});var standardGridPropertiesCountAsynchronous=new Ext.form.Radio({itemId:'standardGridPropertiesCountAsynchronous',boxLabel:l('LBL_STANDARDGRIDPROPERTIES_ASYNCHRONOUSCOUNT'),name:'syncCount',inputValue:2});var standardGridPropertiesCountNone=new Ext.form.Radio({itemId:'standardGridPropertiesCountNone',boxLabel:l('LBL_STANDARDGRIDPROPERTIES_NOCOUNT'),name:'syncCount',inputValue:3});var standardGridViewForm=new Ext.FormPanel({labelAlign:'left',bodyStyle:'padding:5px',layout:'form',items:[{xtype:'radiogroup',id:'standardGridPropertiesCount',fieldLabel:l('LBL_STANDARDGRIDPROPERTIES_COUNT'),columns:1,items:[standardGridPropertiesCountSynchronous,standardGridPropertiesCountAsynchronous,standardGridPropertiesCountNone]}]});var kreportsStandardGridPropertiesWindow=new Ext.Window({title:l('LBL_STANDARDGRIDPROPERTIES_POPUP_TITLE'),layout:'fit',width:600,height:200,closeAction:'hide',plain:true,draggable:true,modal:true,items:standardGridViewForm,listeners:{'show':function(){thisListTypePorperties=Ext.util.JSON.decode(document.getElementById('listtypeproperties').value);switch(thisListTypePorperties[0].counthandling){case 'Asynchronous':standardGridPropertiesCountAsynchronous.setValue(true);break;case 'None':standardGridPropertiesCountNone.setValue(true);break;default:standardGridPropertiesCountSynchronous.setValue(true);break;};},'afterrender':function(){}},buttons:[{text:l('LBL_CANCEL_BUTTON'),handler:function(){eA.hide();}},{text:l('LBL_CLOSE_BUTTON'),handler:function(){document.getElementById('listtypeproperties').value='[{"counthandling":"'+Ext.getCmp('standardGridPropertiesCount').getValue().itemId.replace('standardGridPropertiesCount','')+'"}]';kreportsStandardGridPropertiesWindow.hide();}}]});function kreportsStandardGridPropertiesPopup(){kreportsStandardGridPropertiesWindow.show(this);};var isPremium=false;if(document.getElementById('kreporteredition').value=='premium')isPremium=true;var fK=new Ext.menu.CheckItem({text:l('LBL_LI_TOP10'),checked:false,group:'selectionlimit',id:'selectionlimit_top10',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('selectionlimit').value='top10';}});var fM=new Ext.menu.CheckItem({text:l('LBL_LI_TOP20'),checked:false,group:'selectionlimit',id:'selectionlimit_top20',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('selectionlimit').value='top20';}});var fL=new Ext.menu.CheckItem({text:l('LBL_LI_TOP50'),checked:false,group:'selectionlimit',id:'selectionlimit_top50',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('selectionlimit').value='top50';}});var fE=new Ext.menu.CheckItem({text:l('LBL_LI_NOLIMIT'),checked:false,group:'selectionlimit',id:'selectionlimit_nolimit',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('selectionlimit').value='nolimit';}});var listGridSelectListTypeValues=[['standard'],['grouped'],['grpwthsumm'],['grptree'],['html']];var listGridSelectListTypeLoadLanguage=function(){var bq=function(record){record.set('text',l('LBL_LT_'+record.data.value.toUpperCase()));};listGridSelectListTypeStore.each(bq);};var fG=new Ext.menu.CheckItem({text:l('LBL_LT_STANDARD'),checked:false,group:'listtype',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('listtype').value='standard';P(document.getElementById('listtype').value);}});var fD=new Ext.menu.CheckItem({text:l('LBL_LT_GROUPED'),checked:false,disabled: !isPremium,group:'listtype',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('listtype').value='grouped';P(document.getElementById('listtype').value);}});var fH=new Ext.menu.CheckItem({text:l('LBL_LT_GRPWTHSUM'),checked:false,disabled: !isPremium,group:'listtype',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('listtype').value='grpwthsum';P(document.getElementById('listtype').value);}});var fF=new Ext.menu.CheckItem({text:l('LBL_LT_GRPTREE'),checked:false,disabled: !isPremium,group:'listtype',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('listtype').value='grptree';P(document.getElementById('listtype').value);}});var eN=new Ext.menu.CheckItem({text:l('LBL_LT_PIVOT'),checked:false,disabled: !isPremium,group:'listtype',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('listtype').value='pivot';P(document.getElementById('listtype').value);}});var fI=new Ext.menu.CheckItem({text:l('LBL_LI_PORTRAIT'),checked:false,disabled: !isPremium,group:'pdforientation',id:'pdforientation_portrait',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('pdforientation').value='Portrait';}});var fJ=new Ext.menu.CheckItem({text:l('LBL_LI_LANDSCAPE'),checked:false,disabled: !isPremium,group:'pdforientation',id:'pdforientation_landscape',checkHandler:function(thisElement){if(thisElement.checked==true)document.getElementById('pdforientation').value='Landscape';}});var fy=new Ext.menu.Menu({style:{overflow:'visible'},items:[{text:l('LBL_SELECTION_LIMIT'),icon:'modules/KReports/images/listlimit.png',menu:{items:[fE,fK,fM,fL]}},{text:l('LBL_PDFORIENTATION'),icon:'modules/KReports/images/acrobat.png',disabled: !isPremium,menu:{items:[fJ,fI]}},{text:l('LBL_LISTTYPE'),icon:'modules/KReports/images/listtypes.png',menu:{items:[fG,fD,fH,fF,eN,'-',{text:l('LBL_STANDARDPROPERTIES'),id:'standardpropertiesMenuItem',icon:'modules/KReports/images/reportoptions.png',handler:function(){kreportsStandardGridPropertiesPopup();},hidden:true},{text:l('LBL_TREEPROPERTIES'),id:'treepropertiesMenuItem',icon:'modules/KReports/images/reportoptions.png',handler:function(){ab();},hidden:true},{text:l('LBL_PIVOTPROPERTIES'),id:'pivotpropertiesMenuItem',icon:'modules/KReports/images/reportoptions.png',handler:function(){aj();},hidden:true}]}},{text:l('LBL_MAP'),icon:'modules/KReports/images/map.png',disabled: !isPremium,handler:function(){cs.show();}},]});function P(selectedLayout){Ext.getCmp('treepropertiesMenuItem').hide();Ext.getCmp('pivotpropertiesMenuItem').hide();Ext.getCmp('standardpropertiesMenuItem');switch(selectedLayout){case '':case 'standard':Ext.getCmp('standardpropertiesMenuItem').show();break;case 'grptree':Ext.getCmp('treepropertiesMenuItem').show();break;case 'pivot':Ext.getCmp('pivotpropertiesMenuItem').show();break;}};fy.on('beforeshow',function(){switch(document.getElementById('selectionlimit').value){case 'top10':fK.setChecked(true);break;case 'top20':fM.setChecked(true);break;case 'top50':fL.setChecked(true);break;default:fE.setChecked(true);break;}switch(document.getElementById('pdforientation').value){case 'Portrait':fI.setChecked(true);break;default:fJ.setChecked(true);break;}switch(document.getElementById('listtype').value){case 'grouped':fD.setChecked(true);break;case 'grpwthsum':fH.setChecked(true);break;case 'grptree':fF.setChecked(true);break;case 'pivot':eN.setChecked(true);break;default:fG.setChecked(true);break;}P(document.getElementById('listtype').value);});var L=[{name:'fieldid',mapping:'fieldid'},{name:'sequence',mapping:'sequence'},{name:'name',mapping:'name'},{name:'display',mapping:'display'},{name:'path',mapping:'path'},{name:'displaypath',mapping:'displaypath'},{name:'sort',mapping:'sort'},{name:'sortpriority',mapping:'sortpriority'},{name:'width',mapping:'width'},{name:'jointype',mapping:'jointype'},{name:'sqlfunction',mapping:'sqlfunction'},{name:'customsqlfunction',mapping:'customsqlfunction'},{name:'valuetype',mapping:'valuetype'},{name:'groupby',mapping:'groupby'},{name:'link',mapping:'link'},{name:'fixedvalue',mapping:'fixedvalue'}];var updateFormListfield=function(store){document.getElementById('listfields').value='[';alert('updazte');function cX(record){if(document.getElementById('listfields').value!='['){document.getElementById('listfields').value+=',';}document.getElementById('listfields').value+=Ext.util.JSON.encode(record.data);};A.each(cX);document.getElementById('listfields').value+=']';};Ext.namespace('KINAMU.kreports.eh');KINAMU.kreports.eh.kreportsJsonStore=Ext.extend(KINAMU.kreports.kreportsJsonStore,{constructor:function(config){KINAMU.kreports.eh.kreportsJsonStore.superclass.constructor.call(this,config);},add:function(records){KINAMU.kreports.dI.unionModules.addRecordsToUnion(records);KINAMU.kreports.eh.kreportsJsonStore.superclass.add.call(this,records);},remove:function(record){KINAMU.kreports.dI.unionModules.eT(record);KINAMU.kreports.eh.kreportsJsonStore.superclass.remove.call(this,record);},afterEdit:function(record){KINAMU.kreports.dI.unionModules.eO(record);KINAMU.kreports.eh.kreportsJsonStore.superclass.afterEdit.call(this,record);}});var A=new KINAMU.kreports.eh.kreportsJsonStore({fields:L,domElement:'listfields'});var ck=new Ext.grid.ColumnModel([{header:l('LBL_SEQUENCE'),readOnly:true,dataIndex:'sequence',width:30,sortable:true,hidden:true},{header:l('LBL_PATH'),readOnly:true,dataIndex:'displaypath',width:150,sortable:false},{id:'name',header:l('LBL_NAME'),dataIndex:'name',sortable:false,width:150,editor:new Ext.form.TextField()},{header:l('LBL_DISPLAY'),readOnly:true,dataIndex:'display',width:50,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['no',l('LBL_NO')],['yes',l('LBL_YES')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined)return l('LBL_'+value.toUpperCase());else return value;}},{header:l('LBL_LINK'),readOnly:true,dataIndex:'link',width:50,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['no',l('LBL_NO')],['yes',l('LBL_YES')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined)return l('LBL_'+value.toUpperCase());else return value;}},{header:l('LBL_SORTSEQUENCE'),readOnly:true,dataIndex:'sort',width:50,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['-','-'],['asc',l('LBL_SORT_ASC')],['desc',l('LBL_SORT_DESC')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='-')return l('LBL_SORT_'+value.toUpperCase());else return value;}},{id:'sortpriority',header:l('LBL_SORTPRIORITY'),dataIndex:'sortpriority',sortable:false,width:50,editor:new Ext.form.NumberField()},{id:'width',header:l('LBL_WIDTH'),dataIndex:'width',sortable:false,width:50,editor:new Ext.form.NumberField()},{header:l('LBL_JOIN_TYPE'),readOnly:true,dataIndex:'jointype',width:70,sortable:true,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['optional',l('LBL_JT_OPTIONAL')],['required',l('LBL_JT_REQUIRED')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='-')return l('LBL_JT_'+value.toUpperCase());else return value;}},{header:l('LBL_SQLFUNCTION'),readOnly:true,dataIndex:'sqlfunction',width:70,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['-','-'],['SUM',l('LBL_FUNCTION_SUM')],['COUNT',l('LBL_FUNCTION_COUNT')],['MAX',l('LBL_FUNCTION_MAX')],['MIN',l('LBL_FUNCTION_MIN')],['AVG',l('LBL_FUNCTION_AVG')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='-')return l('LBL_FUNCTION_'+value.toUpperCase());else return value;}},{header:l('LBL_CUSTOMSQLFUNCTION'),readOnly:true,dataIndex:'customsqlfunction',width:70,sortable:false,hidden:false,editor:new Ext.form.TextField()},{header:l('LBL_VALUETYPE'),readOnly:true,dataIndex:'valuetype',width:70,sortable:false,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['-','-'],['POFSUM',l('LBL_VALUETYPE_POFSUM')],['POFCOUNT',l('LBL_VALUETYPE_POFCOUNT')],['POFAVG',l('LBL_VALUETYPE_POFAVG')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined&&value!='-'&&value!='')return l('LBL_VALUETYPE_'+value.toUpperCase());else return value;}},{header:l('LBL_GROUPBY'),readOnly:true,dataIndex:'groupby',width:70,sortable:true,hidden:false,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['value','text'],data:[['no',l('LBL_NO')],['yes',l('LBL_YES')]]}),valueField:'value',displayField:'text'}),renderer:function(value){if(value!=undefined)return l('LBL_'+value.toUpperCase());else return value;}},{id:'fixedvalue',header:l('LBL_FIXEDVALUE'),dataIndex:'fixedvalue',sortable:false,width:80,editor:new Ext.form.TextField()}]);var cS=new Ext.Button({text:l('LBL_DOWN'),icon:'modules/KReports/images/arrow_down.png'});var bd=new Ext.grid.EditorGridPanel({ddGroup:'listGridDDGroup',store:A,cm:ck,sm:new Ext.grid.RowSelectionModel(),clicksToEdit:1,enableDragDrop:true,stripeRows:true,autoExpandColumn:'name',width:325,title:l('LBL_LISTFIELDS'),tbar:new Ext.Toolbar({items:[{text:l('LBL_DOWN_BUTTON_LABEL'),icon:'modules/KReports/images/arrow_down.png',handler:function(){if(bd.getSelectionModel().hasSelection()&&A.indexOf(bd.getSelectionModel().getSelected())<(A.getCount()-1)){var thisRecord=bd.getSelectionModel().getSelected();var bI=A.getAt(A.indexOf(bd.getSelectionModel().getSelected())+1);var bu=thisRecord.data.sequence;var cc=bI.data.sequence;thisRecord.set('sequence',cc);bI.set('sequence',bu);A.sort('sequence','ASC');}}},{text:l('LBL_UP_BUTTON_LABEL'),icon:'modules/KReports/images/arrow_up.png',handler:function(){if(bd.getSelectionModel().hasSelection()&&A.indexOf(bd.getSelectionModel().getSelected())!=0){var thisRecord=bd.getSelectionModel().getSelected();var bG=A.getAt(A.indexOf(bd.getSelectionModel().getSelected())-1);var bu=thisRecord.data.sequence;var ca=bG.data.sequence;thisRecord.set('sequence',ca);bG.set('sequence',bu);A.sort('sequence','ASC');}}},{text:l('LBL_ADDEMTPY_BUTTON_LABEL'),icon:'modules/KReports/images/add.png',handler:function(){var cd=Ext.data.Record.create(L);var bi=new cd({fieldid:cV(),name:'enter name',path:'',displaypath:'',display:'yes',sequence:A.getNextSequence(),width:'100',sort:'-',sortpriority:'',jointype:'required',sqlfunction:'-',groupby:'no',link:'no',fixedvalue:''});A.add(bi);}},{text:l('LBL_DELETE_BUTTON_LABEL'),icon:'modules/KReports/images/delete.png',handler:function(){A.remove(bd.getSelectionModel().getSelected());}},{text:l('LBL_LISTVIEW_OPTIONS'),icon:'modules/KReports/images/tools.png',menu:fy}]})});Ext.namespace('KINAMU.kreports.unionList');KINAMU.kreports.unionList.ds=[{name:'joinid',mapping:'joinid'},{name:'fieldid',mapping:'fieldid'},{name:'sequence',mapping:'sequence'},{name:'name',mapping:'name'},{name:'unionfieldpath',mapping:'unionfieldpath'},{name:'unionfielddisplaypath',mapping:'unionfielddisplaypath'},{name:'unionfieldname',mapping:'unionfieldname'},{name:'path',mapping:'path'},{name:'displaypath',mapping:'displaypath'},{name:'fixedvalue',mapping:'fixedvalue'}];KINAMU.kreports.unionList.bf=new KINAMU.kreports.kreportsJsonStore({fields:KINAMU.kreports.unionList.ds,domElement:'unionlistfields',deleteWithUnionId:function(nodeID){this.clearFilter();var i=this.find('joinid',nodeID);while(i!= -1){this.removeAt(i);i=this.find('joinid',nodeID);}this.clearFilter();},listeners:{'load':function(thisStore){thisStore.each(function(thisRecord){listFieldRecord=A.getAt(A.find('fieldid',thisRecord.data.fieldid));thisRecord.data.name=listFieldRecord.data.name;thisRecord.data.sequence=listFieldRecord.data.sequence;thisRecord.data.path=listFieldRecord.data.path;thisRecord.data.displaypath=listFieldRecord.data.displaypath;});}}});KINAMU.kreports.unionList.di='';KINAMU.kreports.unionList.dP=function(dn){KINAMU.kreports.unionList.di=dn;theseRecords=new Array();function aULR(r,index,bV){var bT=Ext.data.Record.create(KINAMU.kreports.unionList.ds);var tNR=new bT({joinid:KINAMU.kreports.unionList.di,fieldid:r.data.fieldid,sequence:r.data.sequence,unionfieldpath:'',unionfielddisplaypath:'',unionfieldname:'',fixedvalue:'',name:r.data.name,path:r.data.path,displaypath:r.data.displaypath});theseRecords.push(tNR);};A.each(aULR);KINAMU.kreports.unionList.bf.add(theseRecords);};KINAMU.kreports.unionList.dA=new Ext.grid.ColumnModel([{header:l('LBL_SEQUENCE'),readOnly:true,dataIndex:'sequence',width:30,sortable:true,hidden:true},{header:l('LBL_PATH'),readOnly:true,dataIndex:'displaypath',width:150,sortable:false},{id:'name',header:l('LBL_NAME'),dataIndex:'name',sortable:false,width:100},{id:'unionfielddisplaypath',header:l('LBL_UNIONFIELDDISPLAYPATH'),dataIndex:'unionfielddisplaypath',width:150,sortable:false},{id:'unionfieldname',header:l('LBL_UNIONFIELDNAME'),dataIndex:'unionfieldname',width:100,sortable:false},{id:'fixedvalue',header:l('LBL_FIXEDVALUE'),dataIndex:'fixedvalue',sortable:false,width:80,editor:new Ext.form.TextField()}]);KINAMU.kreports.unionList.bE=new Ext.grid.EditorGridPanel({ddGroup:'unionListGridDDGroup',store:KINAMU.kreports.unionList.bf,cm:KINAMU.kreports.unionList.dA,sm:new Ext.grid.RowSelectionModel(),clicksToEdit:1,enableDragDrop:true,stripeRows:true,autoExpandColumn:'name',width:325,title:l('LBL_UNIONLISTFIELDS'),hidden:true});aW=new Ext.data.Store({id:'aW',proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_fields&to_pdf=true'}),reader:new Ext.data.JsonReader({},[{name:'id',type:'string'},{name:'text',type:'string'},{name:'name',type:'string'},{name:'type',type:'string'},{name:'leaf',type:'boolean'}]),sortInfo:{field:'text',direction:"ASC"},loadByNodeId:function(node){this.baseParams.nodeid=node.id;this.load();bc.setTitle(bD(node));bj.setValue('');}});bL=new Ext.grid.ColumnModel([{header:'Fieldname',readOnly:true,dataIndex:'text',width:150,sortable:true,hidden:true},{header:'Name',dataIndex:'name',sortable:true,width:150}]);bL.defaultSortable=true;var bj=new Ext.form.TextField({enableKeyEvents:true,emptyText:'enter search term'});bj.on('valid',function(field){aW.filter('name',field.getValue(),true,false);});bc=new Ext.grid.GridPanel({title:'...',store:aW,cm:bL,clicksToEdit:1,flex:1,loadMask:true,region:'center',stripeRows:true,width:200,maxSize:200,frame:false,enableDragDrop:true,ddGroup:'fieldGridDDGroup',viewConfig:{forceFit:true},tbar:new Ext.Toolbar({items:[bj]})});var co=function(node){var be=node.id;var currentNode=node;while(currentNode.parentNode){currentNode=currentNode.parentNode;be=currentNode.id+'::'+be;}return be;};var bC='';var bD=function(node){bC=co(node);var be=node.text;var currentNode=node;while(currentNode.parentNode){currentNode=currentNode.parentNode;be=currentNode.text+'::'+be;}return be;};var bB=new Ext.tree.TreeLoader({dataUrl:'index.php?module=KReports&action=get_nodes&to_pdf=true',baseParams:{requester:"TREE"}});bB.on("beforeload",function(bN,node){bN.baseParams.currentnodeid=node.attributes.id;},this);bB.on("load",function(bN,node){aW.baseParams.nodeid=node.attributes.id;aW.load();},this);var bo=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_modules&to_pdf=true'}),reader:new Ext.data.JsonReader({'fields':[{name:'module'},{name:'description'}]})});bo.load();var ao=new Ext.form.ComboBox({store:bo,id:'module_combo',name:'module_combo',valueField:'module',displayField:'description',typeAhead:true,mode:'local',triggerAction:'all',emptyText:'Select a module.',aR:true,width:135});var bx=function(){if(ao.value==''){bz.setVisible(false);ao.setDisabled(false);}else{bz.setVisible(true);ao.setDisabled(true);}};var bz=new Ext.Button({resizable:true,icon:'modules/KReports/images/lock_open.png',handler:function(){Ext.Msg.confirm('unlock Root Module','changing the root module will erase all Defintions',function(f,text){if(f=='yes'){ao.clearValue();bo.load();bo.removeAll();ad.removeAll();ai.removeAll();A.removeAll();aW.removeAll();ef.root.destroy();eV();bx();}});}});var er=new Ext.tree.AsyncTreeNode({text:ao.value,draggable:false,id:"root:"+ao.value});var ci=function(){ao.setValue(Ext.get('report_module').dom.value);};var cl=function(){if(ao.value!=''){er.setId("root:"+ao.value);er.setText(ao.value);ef.root.select();}else{}};var ef=new Ext.tree.TreePanel({title:'Modules',id:'tree-panel',flex:1,split:true,width:200,minSize:100,autoScroll:true,rootVisible:true,lines:false,singleExpand:true,useArrows:true,enableDragDrop:false,loader:bB,root:er,tbar:new Ext.Toolbar({items:[ao,bz]})});ef.on('expand',function(){bd.show();if(!KINAMU.kreports.unionList.bE.collapsed)bd.expand();KINAMU.kreports.unionList.bE.hide();KINAMU.kreports.cy.show();aW.loadByNodeId(ef.getSelectionModel().getSelectedNode());cj();fW.show();});ao.on('select',function(){var aY=new Ext.tree.AsyncTreeNode({text:ao.value,draggable:false,id:"root:"+ao.value});ef.setRootNode(aY);ai.removeAll();A.removeAll();aW.removeAll();aW.loadByNodeId(aY);bx();document.getElementById('report_module').value=ao.value;});ef.getSelectionModel().on('selectionchange',function(){});ef.on('click',function(node,e){aW.loadByNodeId(node);});Ext.namespace('KINAMU.kreports.dI');KINAMU.kreports.dI.dD=new Ext.tree.TreeLoader({dataUrl:'index.php?module=KReports&action=get_nodes&to_pdf=true',baseParams:{requester:"TREE"}});KINAMU.kreports.dI.unionModuleFields=[{name:'unionid',mapping:'unionid'},{name:'module',mapping:'module'}];KINAMU.kreports.dI.unionModules=new KINAMU.kreports.kreportsJsonStore({fields:KINAMU.kreports.dI.unionModuleFields,domElement:'union_modules',addRecordsToUnion:function(records){var ep=Ext.data.Record.create(KINAMU.kreports.unionList.ds);for(G=0;G<this.data.items.length;G++){if(records.length){for(recordIndex=0;recordIndex<records.length;recordIndex++){KINAMU.kreports.unionList.bf.add(new ep({joinid:this.data.items[G].data.unionid,fieldid:records[recordIndex].get('fieldid'),sequence:records[recordIndex].get('sequence'),name:records[recordIndex].get('name'),path:records[recordIndex].get('path'),displaypath:records[recordIndex].get('displaypath')}));}}else{KINAMU.kreports.unionList.bf.add(new ep({joinid:this.data.items[G].data.unionid,fieldid:records.get('fieldid'),sequence:records.get('sequence'),name:records.get('name'),path:records.get('path'),displaypath:records.get('displaypath')}));}}KINAMU.kreports.unionList.bf.filter('joinid',KINAMU.kreports.dI.cI());},eT:function(record){if(record!=undefined){KINAMU.kreports.unionList.bf.clearFilter();while(KINAMU.kreports.unionList.bf.find('fieldid',record.get('fieldid'))>=0){KINAMU.kreports.unionList.bf.remove(KINAMU.kreports.unionList.bf.getAt(KINAMU.kreports.unionList.bf.find('fieldid',record.get('fieldid'))));}KINAMU.kreports.unionList.bf.filter('joinid',KINAMU.kreports.dI.cI());}},eO:function(record){KINAMU.kreports.unionList.bf.clearFilter();var startIndex=0;while(KINAMU.kreports.unionList.bf.find('fieldid',record.get('fieldid'),startIndex)>=0){updateRecord=KINAMU.kreports.unionList.bf.getAt(KINAMU.kreports.unionList.bf.find('fieldid',record.get('fieldid'),startIndex));updateRecord.beginEdit();updateRecord.set('sequence',record.get('sequence'));updateRecord.set('name',record.get('name'));updateRecord.set('path',record.get('path'));updateRecord.set('displaypath',record.get('displaypath'));updateRecord.endEdit();startIndex=KINAMU.kreports.unionList.bf.indexOf(updateRecord)+1;}KINAMU.kreports.unionList.bf.sort('sequence','ASC');KINAMU.kreports.unionList.bf.filter('joinid',KINAMU.kreports.dI.cI());}});var unionModules='';KINAMU.kreports.dI.dO=function(){KINAMU.kreports.dI.unionModules.loadDirect();for(i=0;i<KINAMU.kreports.dI.unionModules.getCount();i++){var cJ=new Ext.tree.AsyncTreeNode({text:KINAMU.kreports.dI.unionModules.getAt(i).get('module'),draggable:false,id:"union"+KINAMU.kreports.dI.unionModules.getAt(i).get('unionid')+':'+KINAMU.kreports.dI.unionModules.getAt(i).get('module')});KINAMU.kreports.dI.bh.getRootNode().appendChild(cJ);}if(KINAMU.kreports.dI.unionModules.getCount()>0){KINAMU.kreports.dI.bh.getRootNode().firstChild.select();}};KINAMU.kreports.dI.dM=function(node){var be=node.id;var currentNode=node;while(currentNode.parentNode&&currentNode.parentNode.id!='unionroot'){currentNode=currentNode.parentNode;be=currentNode.id+'::'+be;}return be;};KINAMU.kreports.dI.du=function(node){bC=co(node);var be=node.text;var currentNode=node;while(currentNode.parentNode&&currentNode.parentNode.id!='unionroot'){currentNode=currentNode.parentNode;be=currentNode.text+'::'+be;}return be;};KINAMU.kreports.dI.dW=function(node){if(node.parentNode.id=='unionroot')return true;else return false;};KINAMU.kreports.dI.dN=function(node){var currentNode=node;while(currentNode.parentNode&&currentNode.parentNode.id!='unionroot'){currentNode=currentNode.parentNode;}return currentNode;};KINAMU.kreports.dI.cI=function(node){if(node==null||node!=undefined){if(KINAMU.kreports.dI.unionModules.getCount()>0){node=KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode();}else return '';}var currentNode=node;while(currentNode.parentNode&&currentNode.parentNode.id!='unionroot'){currentNode=currentNode.parentNode;}var splitArray=currentNode.id.split(':');return splitArray[0].replace('union','');};KINAMU.kreports.dI.es=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_modules&to_pdf=true'}),reader:new Ext.data.JsonReader({'fields':[{name:'module'},{name:'description'}]})});KINAMU.kreports.dI.es.load();KINAMU.kreports.dI.cF=new Ext.form.ComboBox({store:KINAMU.kreports.dI.es,id:'union_module_combo',name:'union_module_combo',valueField:'module',displayField:'description',typeAhead:true,mode:'local',triggerAction:'all',emptyText:'Select a module.',aR:true,width:100,listeners:{'select':function(){KINAMU.kreports.dI.df.enable();}}});KINAMU.kreports.dI.dG=new Ext.Button({icon:'modules/KReports/images/delete.png',handler:function(){Ext.Msg.confirm('remove Union Module','remove the Union module and all related definitions',function(f,text){if(f=='yes'){KINAMU.kreports.unionList.bf.deleteWithUnionId(KINAMU.kreports.dI.cI(KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode()));KINAMU.kreports.dI.unionModules.remove(KINAMU.kreports.dI.unionModules.getAt(KINAMU.kreports.dI.unionModules.find('unionid',KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode().id.substring(5,33))));KINAMU.kreports.dI.dN(KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode()).destroy();if(KINAMU.kreports.dI.bn.hasChildNodes()){KINAMU.kreports.dI.bn.childNodes[0].select();KINAMU.kreports.unionList.bf.filter('joinid',KINAMU.kreports.dI.cI(KINAMU.kreports.dI.bn.childNodes[0]));}}});}});KINAMU.kreports.dI.df=new Ext.Button({icon:'modules/KReports/images/add.png',handler:function(){var newGuid=cV();var eI=Ext.data.Record.create(KINAMU.kreports.dI.unionModuleFields);var eF=new eI({unionid:newGuid,module:KINAMU.kreports.dI.cF.value});KINAMU.kreports.dI.unionModules.add(eF);var cJ=new Ext.tree.AsyncTreeNode({text:KINAMU.kreports.dI.cF.value,draggable:false,id:"union"+newGuid+":"+KINAMU.kreports.dI.cF.value});KINAMU.kreports.dI.bh.getRootNode().appendChild(cJ);cJ.select();KINAMU.kreports.unionList.dP(newGuid);KINAMU.kreports.dI.cF.clearValue();KINAMU.kreports.dI.df.disable();},disabled:true});KINAMU.kreports.dI.bn=new Ext.tree.AsyncTreeNode({text:ao.value,draggable:false,id:"unionroot"});KINAMU.kreports.dI.dr=function(){if(KINAMU.kreports.dI.bn.hasChildNodes())KINAMU.kreports.cy.show();else KINAMU.kreports.cy.hide();};KINAMU.kreports.dI.bh=new Ext.tree.TreePanel({title:l('LBL_UNIONTREE'),id:'uniontree-panel',flex:1,split:true,width:200,minSize:100,autoScroll:true,rootVisible:false,lines:false,singleExpand:true,useArrows:true,enableDragDrop:false,disabled:false,loader:KINAMU.kreports.dI.dD,root:KINAMU.kreports.dI.bn,tbar:new Ext.Toolbar({items:[KINAMU.kreports.dI.dG,'-',KINAMU.kreports.dI.df,KINAMU.kreports.dI.cF]}),listeners:{'expand':function(){KINAMU.kreports.unionList.bE.show();if(!bd.collapsed)KINAMU.kreports.unionList.bE.expand();bd.hide();if(!KINAMU.kreports.dI.bn.hasChildNodes()){KINAMU.kreports.cy.hide();}else{cj();aW.loadByNodeId(KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode());}},'append':KINAMU.kreports.dI.dr,'remove':KINAMU.kreports.dI.dr}});KINAMU.kreports.dI.bh.getSelectionModel().on('selectionchange',function(selectionModel,node){if(node!=null){aW.loadByNodeId(node);KINAMU.kreports.unionList.bf.filter('joinid',KINAMU.kreports.dI.cI(node));cj();}});var cp=function(){var bS=ah.getView().el.dom.childNodes[0].childNodes[1];var cQ=new Ext.dd.DropTarget(bS,{ddGroup:'fieldGridDDGroup',copy:false,notifyDrop:function(cu,e,data){function cU(record,index,bV){var bT=Ext.data.Record.create(KINAMU.kreports.aO);var bi=new bT({unionid:cf(),fieldid:cV(),path:bC+'::'+record.data.id,name:record.data.name,type:record.data.type,displaypath:bc.title,groupid:currentNode.id,referencefieldid:'',operator:'equals',jointype:'required',usereditable:'no'});ai.add(bi);};Ext.each(cu.dragData.selections,cU);ai.sort('name','ASC');ai.filter('groupid',bb.getSelectionModel().getSelectedNode().id);bA.disable();return(true);}});var cg=bd.getView().el.dom.childNodes[0].childNodes[1];var cO=new Ext.dd.DropTarget(cg,{ddGroup:'fieldGridDDGroup',copy:false,notifyDrop:function(cu,e,data){function cU(record,index,bV){var bU=A.findExact('path',bc.title+'::'+record.data.id);if(bU== -1){var cd=Ext.data.Record.create(L);var bi=new cd({fieldid:cV(),path:bC+'::'+record.data.id,displaypath:bc.title,name:record.data.name,display:'yes',sequence:A.getNextSequence(),width:'100',sort:'-',sortpriority:'',jointype:'required',sqlfunction:'-',groupby:'no',link:'no',fixedvalue:''});A.add(bi);A.sort('sequence','ASC');}};Ext.each(cu.dragData.selections,cU);return(true);}});var dH=KINAMU.kreports.unionList.bE.getView().scroller.dom;var ee='';var ec=new Ext.dd.DropTarget(dH,{ddGroup:'fieldGridDDGroup',copy:false,onNodeEnter:function(target,dd,e,dragData){alert('enter');},notifyDrop:function(cu,e,data){var dq=[{name:'fieldid',mapping:'fieldid'},{name:'name',mapping:'name'}];var dk=new Ext.data.JsonStore({fields:dq});function fQ(record,index,bV){var bT=Ext.data.Record.create(dq);var bi=new bT({fieldid:record.data.fieldid,name:record.data.name});dk.add(bi);};KINAMU.kreports.unionList.bf.each(fQ);cE=cu.dragData.selections[0];var cL=new Ext.grid.GridPanel({store:dk,columns:[{id:'fieldid',header:l('LBL_MULTISELECT_TEXT_HEADER'),hidden:true},{id:'name',header:l('LBL_MULTISELECT_TEXT_HEADER')}],selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),stripeRows:true,autoExpandColumn:'name',height:350,width:400});var setPathFromDialog=function(){win.hide();var selectedRecord=cL.getSelectionModel().getSelected();var recordIndex=KINAMU.kreports.unionList.bf.find('fieldid',selectedRecord.data.fieldid);var record=KINAMU.kreports.unionList.bf.getAt(recordIndex);record.set('unionfieldpath',KINAMU.kreports.dI.dM(KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode())+'::'+cE.data.id);record.set('unionfieldname',cE.data.name);record.set('unionfielddisplaypath',KINAMU.kreports.dI.du(KINAMU.kreports.dI.bh.getSelectionModel().getSelectedNode()));};cL.on('celldblclick',setPathFromDialog);var win=new Ext.Window({title:l('LBL_MUTLISELECT_POPUP_TITLE'),layout:'fit',width:500,height:300,closeAction:'hide',plain:true,draggable:true,modal:true,items:cL,buttons:[{text:l('LBL_MUTLISELECT_CANCEL_BUTTON'),handler:function(){win.hide();}},{text:l('LBL_MUTLISELECT_CLOSE_BUTTON'),handler:setPathFromDialog}]});win.show(this);return(true);}});};Ext.onReady(function(){ad.loadDirect();cj();ai.loadDirect();A.loadDirect();KINAMU.kreports.unionList.bf.loadDirect();if(document.getElementById('chart_params_new').value!='')eg.loadData(Ext.util.JSON.decode(document.getElementById('chart_params_new').value));if(document.getElementById('kreporteredition').value=='premium')KINAMU.kreports.eZ=new Ext.Panel({title:l('LBL_DEFINITIONS'),region:'center',split:true,width:600,height:500,layout:'accordion',items:[KINAMU.kreports.cy,bd,KINAMU.kreports.unionList.bE,fW]});else KINAMU.kreports.eZ=new Ext.Panel({title:l('LBL_DEFINITIONS'),region:'center',split:true,width:600,height:500,layout:'accordion',items:[KINAMU.kreports.cy,bd,KINAMU.kreports.unionList.bE]});KINAMU.kreports.fa=new Ext.Panel({title:l('LBL_MODULES'),width:200,height:300,layout:'accordion',activeOnTop:true,items:[ef,KINAMU.kreports.dI.bh]});KINAMU.kreports.modulePanel=new Ext.Panel({region:'west',width:200,height:600,collapsible:false,layout:'vbox',layoutConfig:{align:'stretch',pack:'start'},items:[KINAMU.kreports.fa,bc]});var cP=new Ext.Panel({renderTo:'layoutregion',monitorResize:true,height:600,layout:'border',layoutConfig:{align:'stretch',pack:'pack'},defaults:{flex:1},items:[KINAMU.kreports.modulePanel,KINAMU.kreports.eZ]});if(ao.value!=''){ci();cl();bx();KINAMU.kreports.dI.dO();aW.baseParams.nodeid=ef.root.id;aW.load();bc.setTitle(bD(ef.root));bj.setValue('');bb.root.select();bK(bb.root);}if(document.getElementById('kreporteredition').value=='premium'){if(document.getElementById('colorschema').value!=''){var colorschema;eval("colorschema = "+document.getElementById('colorschema').value);ga.loadData(colorschema);}cIndexComboStoreFill(cLayoutCount[cLayoutCombo.value]);}cp();});