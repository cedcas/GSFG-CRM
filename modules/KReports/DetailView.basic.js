var F=new Ext.data.JsonStore({fields:[{name:'lblid',type:'string'},{name:'value',type:'string'}]});if(document.getElementById('jsonlanguage').value!=''){var jsonLanguage;eval("jsonLanguage = "+document.getElementById('jsonlanguage').value);F.loadData(Ext.util.JSON.decode(document.getElementById('jsonlanguage').value));}var l=function(M){var recordNumber=F.find('lblid',M);if(recordNumber>=0){return F.getAt(recordNumber).data.value;}else{return M;}};var m=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_enum&to_pdf=true'}),reader:new Ext.data.JsonReader({'fields':[{name:'value'},{name:'text'}]})});var aS=new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:m,displayField:'text'});var as=[['ignore',0],['equals',1],['notequal',1],['greater',1],['greaterequal',1],['less',1],['lessequal',1],['starts',1],['notstarts',1],['contains',1],['notcontains',1],['between',2],['isempty',0],['isnotempty',0]];var ay=[['ignore',0],['equals',1],['notequal',1],['greater',1],['greaterequal',1],['less',1],['lessequal',1],['between',2],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aA=[['ignore',0],['equals',1],['notequal',1],['oneof',1],['oneofnot',1],['oneofnotornull',1],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aB=[['ignore',0],['equals',1],['notequal',1],['before',1],['after',1],['between',2],['thismonth',0],['next3month',0],['lastmonth',0],['last3month',0],['thisyear',0],['lastyear',0],['isempty',0],['isemptyornull',0],['isnull',0],['isnotempty',0]];var aG=[['ignore',0],['equals',1],['notequal',1],['isemptyornull',0],['isnull',0]];var whereOperatorsFields=[{name:'operator'},{name:'values',type:'float'},{name:'display'}];var af=new Ext.data.ArrayStore({fields:whereOperatorsFields});var aH=function(){var V=function(record){record.set('display',l('LBL_OP_'+record.data.operator.toUpperCase()));};af.each(V);};var av=function(ap){af.removeAll();switch(ap){case 'date':case 'datetime':case 'datetimecombo':af.loadData(aB);break;case 'id':case 'varchar':case 'text':case 'name':af.loadData(as);break;case 'int':case 'double':case 'float':case 'currency':af.loadData(ay);break;case 'bool':af.loadData(aG);break;case 'enum':case 'multienum':case 'user_name':case 'assigned_user_name':af.loadData(aA);break;}aH();};var aE=function(aQ,ap){av(ap);var aw=af.find('operator',aQ);if(aw>=0){return af.getAt(aw).data.values;}else{return 0;}};var B;var J;var R;var aF=function(e,ag,ah){if(ag.getColumnId(e.column)=='value'||ag.getColumnId(e.column)=='valueto'){var ax=aE(e.record.data.operator,e.record.data.type);if(ax===0||(ag.getColumnId(e.column)=='valueto'&&ax!=2)){ah.getColumnModel().setEditor(null);}else{switch(e.record.data.type){case 'datetime':ah.getColumnModel().setEditor(e.column,new Ext.form.DateField({format:cal_date_format.replace(/%/g,'')}));break;case 'date':ah.getColumnModel().setEditor(e.column,new Ext.form.DateField({format:cal_date_format.replace(/%/g,'')}));break;case 'user_name':case 'assigned_user_name':case 'enum':case 'multienum':m.removeAll();m.setBaseParam('path',e.record.data.path);m.load();switch(e.record.data.operator){case('oneof'):var at=new Ext.grid.GridPanel({store:m,columns:[{id:'text',header:l('LBL_MULTISELECT_VALUE_HEADER'),hidden:true},{id:'value',header:l('LBL_MULTISELECT_TEXT_HEADER')}],stripeRows:true,autoExpandColumn:'value',height:350,width:600});m.on('load',function(){var I=B.record.data.valuekey.split(',');for(var i=0;i<I.length;i++){var G=m.find('value',I[i]);if(G!= -1){at.getSelectionModel().selectRow(G,true);}}});B=e;J=ah;R=ag;var win=new Ext.Window({title:l('LBL_MUTLISELECT_POPUP_TITLE'),layout:'fit',width:500,height:300,closeAction:'hide',plain:true,draggable:true,modal:true,items:at,buttons:[{text:l('LBL_MUTLISELECT_CANCEL_BUTTON'),handler:function(){win.hide();}},{text:l('LBL_MUTLISELECT_CLOSE_BUTTON'),handler:function(){win.hide();var aa=at.getSelectionModel();var selectedRows=aa.getSelections();var newValue='';var an='';for(var i=0,O=selectedRows.length;i<O;i++){if(newValue!=''){newValue+=', ';}newValue+=selectedRows[i].data.text;if(an!=''){an+=',';}an+=selectedRows[i].data.value;}B.record.set('value',newValue);B.record.set('valuekey',an);J.fireEvent('afteredit',B);}}]});win.show(this);break;default:ah.getColumnModel().setEditor(e.column,new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:m,displayField:'text',valueField:'value'}));break;}break;default:ah.getColumnModel().setEditor(e.column,new Ext.form.TextField());break;}}}if(ag.getColumnId(e.column)=='operator'){av(e.record.data.type);ah.getColumnModel().setEditor(e.column,new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:af,displayField:'display',valueField:'operator'}));}};var aI=function(e,ag){if(ag.getColumnId(e.column)=='value'||ag.getColumnId(e.column)=='valueto'){switch(e.record.data.type){case 'datetime':e.record.set(ag.getColumnId(e.column),e.value.format('Y-m-d H:i:s'));break;case 'date':e.record.set(ag.getColumnId(e.column),e.value.format('Y-m-d H:i:s'));break;case 'user_name':case 'assigned_user_name':case 'enum':switch(e.record.data.operator){case('oneof'):break;default:e.record.set(ag.getColumnId(e.column)+'key',e.value);e.record.set(ag.getColumnId(e.column),m.getAt(m.find('value',e.value)).data.text);break;}break;default:break;}}if(ag.getColumnId(e.column)=='operator'){if(e.originalValue!=e.value){if(af.getAt(af.find('operator',e.originalValue)).data.values!=af.getAt(af.find('operator',e.value)).data.values||(e.value.indexOf('oneof')!=e.originalValue.indexOf('oneof'))){switch(af.getAt(af.find('operator',e.value)).data.values){case 0:e.record.set('value','---');e.record.set('valueto','---');e.record.set('valuekey','');e.record.set('valuetokey','');break;case 2:e.record.set('value','');e.record.set('valueto','');e.record.set('valuekey','');e.record.set('valuetokey','');break;default:e.record.set('value','');e.record.set('valueto','---');e.record.set('valuekey','');e.record.set('valuetokey','');}}}}};var dj=[{name:'jobid'},{name:'month',mapping:'month'},{name:'method',mapping:'method'},{name:'dayofmonth',mapping:'dayofmonth'},{name:'dayofweek',mapping:'dayofweek'},{name:'hour',mapping:'hour'},{name:'minutes',mapping:'minutes'},{name:'action',mapping:'action'},{name:'receipients',mapping:'receipients'}];var db=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['*',l('LBL_SCHED_MONTH_00')],['1',l('LBL_SCHED_MONTH_01')],['2',l('LBL_SCHED_MONTH_02')],['3',l('LBL_SCHED_MONTH_03')],['4',l('LBL_SCHED_MONTH_04')],['5',l('LBL_SCHED_MONTH_05')],['6',l('LBL_SCHED_MONTH_06')],['7',l('LBL_SCHED_MONTH_07')],['8',l('LBL_SCHED_MONTH_08')],['9',l('LBL_SCHED_MONTH_09')],['10',l('LBL_SCHED_MONTH_10')],['11',l('LBL_SCHED_MONTH_11')],['12',l('LBL_SCHED_MONTH_12')]]});var eb=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['00',l('LBL_SCHED_WEEK_00')],['01',l('LBL_SCHED_WEEK_01')],['02',l('LBL_SCHED_WEEK_02')],['03',l('LBL_SCHED_WEEK_03')],['04',l('LBL_SCHED_WEEK_04')],['05',l('LBL_SCHED_WEEK_05')]]});var da=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['*',l('LBL_SCHED_DAY_00')],['1',l('LBL_SCHED_DAY_01')],['2',l('LBL_SCHED_DAY_02')],['3',l('LBL_SCHED_DAY_03')],['4',l('LBL_SCHED_DAY_04')],['5',l('LBL_SCHED_DAY_05')],['6',l('LBL_SCHED_DAY_06')],['7',l('LBL_SCHED_DAY_07')],['1,2,3,4,5',l('LBL_SCHED_DAY_08')]]});var cZ=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['*',l('LBL_SCHED_DAY_00')],['0','0'],['1','1'],['2','2'],['3','3'],['4','4'],['5','5'],['6','6'],['7','7'],['8','8'],['9','9'],['10','10'],['11','11'],['12','12'],['13','13'],['14','14'],['15','15'],['16','16'],['17','17'],['18','18'],['19','19'],['20','20'],['21','21'],['22','22'],['23','23'],['24','24'],['25','25'],['26','26'],['27','27'],['28','28'],['29','29'],['30','30'],['31','31']]});var cK=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['*',l('LBL_SCHED_HR_EVERY')],['0','00'],['1','01'],['2','02'],['3','03'],['4','04'],['5','05'],['6','06'],['7','07'],['8','08'],['9','09'],['10','10'],['11','11'],['12','12'],['13','13'],['14','14'],['15','15'],['16','16'],['17','17'],['18','18'],['19','19'],['20','20'],['21','21'],['22','22'],['23','23']]});var cN=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['00','00'],['15','15'],['30','30'],['45','45']]});var cR=new Ext.data.ArrayStore({fields:['fieldvalueid','fieldname'],data:[['1',l('LBL_SCHED_ACTION_1')],['2',l('LBL_SCHED_ACTION_2')],['3',l('LBL_SCHED_ACTION_3')]]});var dS=new Ext.data.JsonWriter({encode:true,writeAllFields:true});var cH=new Ext.data.Store({idProperty:'jobid',proxy:new Ext.data.HttpProxy({api:{read:'index.php?module=KReports&action=get_report_schedule&to_pdf=true&api=read',create:'index.php?module=KReports&action=get_report_schedule&to_pdf=true&api=create',update:'index.php?module=KReports&action=get_report_schedule&to_pdf=true&api=update',destroy:'index.php?module=KReports&action=get_report_schedule&to_pdf=true&api=destroy'}}),baseParams:{requester:document.getElementById('recordid').value},reader:new Ext.data.JsonReader({fields:dj,root:'data',idProperty:'jobid',messageProperty:'message'}),writer:dS});var dQ=new Ext.Button({text:l('LBL_SCHEDULER_PANEL_ADDBUTTON'),icon:'modules/KReports/images/add.png',handler:function(){var bT=Ext.data.Record.create(dj);var bi=new bT({jobid:'new',month:'*',dayofmonth:'*',dayofweek:'*',hour:'0',minutes:'00',action:'1',receipients:''});cH.add(bi);}});cG=new Ext.grid.CheckboxSelectionModel();var dc=new Ext.Button({text:l('LBL_SCHEDULER_PANEL_REMOVEBUTTON'),icon:'modules/KReports/images/delete.png',handler:function(){cH.remove(cG.getSelections());},disabled:true});cG.on('selectionchange',function(){if(cG.getCount()>0)dc.enable();else dc.disable();});var dJ=new Ext.grid.ColumnModel([cG,{id:'jobid',dataIndex:'jobid',hidden:true},{id:'month',dataIndex:'month',width:80,header:l('LBL_SCHED_MONTH'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:db,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value,metaData,record,rowIndex,colIndex,store){return db.getAt(db.find('fieldvalueid',value)).data.fieldname;}},{id:'dayofmonth',dataIndex:'dayofmonth',width:50,header:l('LBL_SCHED_DAYOFMONTH'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:cZ,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value,metaData,record,rowIndex,colIndex,store){return cZ.getAt(cZ.find('fieldvalueid',value)).data.fieldname;}},{id:'dayofweek',dataIndex:'dayofweek',header:l('LBL_SCHED_DAYOFWEEK'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:da,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value){return da.getAt(da.find('fieldvalueid',value)).data.fieldname;}},{id:'hour',dataIndex:'hour',width:60,header:l('LBL_SCHED_HOUR'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:cK,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value){return cK.getAt(cK.find('fieldvalueid',value)).data.fieldname;}},{id:'minutes',dataIndex:'minutes',width:60,header:l('LBL_SCHED_MIN'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:cN,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value){return cN.getAt(cN.find('fieldvalueid',value)).data.fieldname;}},{id:'action',dataIndex:'action',header:l('LBL_SCHED_ACT'),editor:new Ext.form.ComboBox({typeAhead:false,triggerAction:'all',lazyRender:true,mode:'local',store:cR,valueField:'fieldvalueid',displayField:'fieldname'}),renderer:function(value){return cR.getAt(cR.find('fieldvalueid',value)).data.fieldname;}},{id:'receipients',dataIndex:'receipients',header:l('LBL_SCHED_RECEIPIENTS'),editor:new Ext.form.TextField()}]);var dR=new Ext.grid.EditorGridPanel({store:cH,cm:dJ,clicksToEdit:1,autoExpandColumn:'receipients',height:350,width:800,sm:cG,tbar:new Ext.Toolbar({items:[dQ,dc]})});var de=new Ext.Window({title:l('LBL_SCHEDULER_POPUP_TITLE'),layout:'fit',width:800,height:380,closeAction:'hide',plain:true,draggable:true,modal:true,items:dR,buttons:[{text:l('LBL_MUTLISELECT_CANCEL_BUTTON'),handler:function(){de.hide();}},{text:l('LBL_MUTLISELECT_CLOSE_BUTTON'),handler:function(){de.hide();}}]});function fP(){cH.load();de.show(this);};var Q='';var g=0;var C=0;var ar=new Ext.LoadMask(Ext.getBody(),{msg:"creating TargetList ... "});var bl=new Ext.LoadMask(Ext.getBody(),{msg:"geocoding Results ... "});var aq=new Ext.LoadMask(Ext.getBody(),{msg:"taking snapshot ... "});var k=new Ext.LoadMask(Ext.getBody(),{msg:"loading"});Ext.onReady(function(){if(document.getElementById('reportoptions').value!='')reportOptionsObject=Ext.util.JSON.decode(document.getElementById('reportoptions').value);else reportOptionsObject=new Object();if(document.getElementById('bingmapskey')!=null&&document.getElementById('bingmapskey').Value!=''){fO();}if(document.getElementById('geocodeEnable').value=='X')massGeoCodeDisabled=false;else massGeoCodeDisabled=true;var dB=function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=check_export_to_targetlist',success:function(response,options){if(response.responseText=='true'){Ext.getCmp('KReportsAddTargetListButton').enable();}else{Ext.getCmp('KReportsAddTargetListButton').disable();}},params:{record:document.getElementById('recordid').value}});};var dm=function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=check_access_level',success:function(response,options){if(response.responseText.trim()=='1'||response.responseText.trim()=='2'){Ext.getCmp('KReportsEditReportButton').enable();Ext.getCmp('KReportsDuplicateReportButton').enable();}if(response.responseText.trim()=='2'){Ext.getCmp('KReportsDeleteReportButton').enable();}},params:{record:document.getElementById('recordid').value}});};var aO=[{name:'fieldid',mapping:'fieldid'},{name:'sequence',mapping:'sequence'},{name:'name',mapping:'name'},{name:'groupid',mapping:'groupid'},{name:'path',mapping:'path'},{name:'displaypath',mapping:'displaypath'},{name:'operator',mapping:'operator'},{name:'type',mapping:'type'},{name:'value',mapping:'value'},{name:'valuekey',mapping:'valuekey'},{name:'valueto',mapping:'valueto'},{name:'valuetokey',mapping:'valuetokey'},{name:'jointype',mapping:'jointype'},{name:'include',mapping:'include'}];var ai=new Ext.data.JsonStore({fields:aO,paramsAsHash:true,sortInfo:{field:'sequence',direction:'ASC'},listeners:{'add':function(thisItem){au();},'update':function(thisItem){au();},'remove':function(thisItem){au();}}});var D=function(store){var ae='[';function dp(record){if(ae!='['){ae+=',';}ae+=Ext.util.JSON.encode(record.data);};ai.each(dp);ae+=']';return ae;};var au=function(store){var ae='[';function dp(record){if(ae!='[')ae+=',';ae+=Ext.util.JSON.encode(record.data);};ai.each(dp);ae+=']';document.getElementById('dynamicoptions').value=ae;};if(document.getElementById('dynamicoptions').value!=''){var dynamicoptions;eval("dynamicoptions = "+document.getElementById('dynamicoptions').value);ai.loadData(dynamicoptions);var ag=new Ext.grid.ColumnModel([{header:l('LBL_FIELDNAME'),readOnly:true,dataIndex:'displaypath',width:150,sortable:true,hidden:true},{id:'name',header:l('LBL_NAME'),dataIndex:'name',sortable:true,width:150},{id:'operator',header:l('LBL_OPERATOR'),readOnly:true,dataIndex:'operator',width:150,sortable:true,hidden:false,renderer:function(value,metaData,record,rowIndex,colIndex,store){return l('LBL_OP_'+value.toUpperCase());},editor:new Ext.form.TextField()},{id:'value',header:l('LBL_VALUE_FROM'),dataIndex:'value',sortable:true,hidden:false,width:150,editor:new Ext.form.TextField()},{id:'valueto',header:l('LBL_VALUE_TO'),dataIndex:'valueto',sortable:true,hidden:false,width:150,editor:new Ext.form.TextField()}]);if(reportOptionsObject.optionsFolded!=undefined&&reportOptionsObject.optionsFolded==false)optionsCollapsed=false;else optionsCollapsed=true;var ah=new Ext.grid.EditorGridPanel({store:ai,cm:ag,clicksToEdit:1,stripeRows:true,height:250,collapsed:optionsCollapsed,collapsible:true,renderTo:'optionsArea',title:l('LBL_DYNAMIC_OPTIONS'),listeners:{'beforeedit':function(e){aF(e,ag,ah);},'afteredit':function(e){aI(e,ag);if(document.getElementById('haschart').value=='X')H();reloadReportStore(D());if(bk!='undefined'){bk.removeAll();bk.setBaseParam('whereConditions',D());bk.load();}}}});};var am=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=get_snapshots&to_pdf=true&requester='+document.getElementById('recordid').value}),reader:new Ext.data.JsonReader({'fields':[{name:'snapshot'},{name:'description'}]})});am.load();var ak=new Ext.form.ComboBox({store:am,id:'snapshot_combo',name:'snapshot_combo',displayField:'description',valueField:'snapshot',typeAhead:true,editable:false,value:'current',mode:'local',triggerAction:'all',aR:true,width:135,iconCls:'no-icon',listeners:{'select':function(){if(document.getElementById('dynamicoptions').value!=''){if(ak.value==0)ah.show();else ah.hide();}store.setBaseParam('snapshotid',ak.value);store.load();H();}}});var H=function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=getcharthtml',success:function(response){eval(response.responseText);},failure:function(response){document.getElementById('chartArea').innerHTML='';},params:{whereConditions:D(),record:document.getElementById('recordid').value,snapshotid:ak.value}});};var aP=function(){aq.show();Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=take_snapshot',success:function(){aq.hide();am.load();},failure:function(){aq.hide();am.load();},params:{record:document.getElementById('recordid').value}});};var aC=new Ext.menu.Item({text:l('LBL_EXPORT_TO_PDFWCHART_BUTTON_LABEL'),icon:'modules/KReports/images/acrobat.png',handler:function(){aN();},disabled:true});var bH=new Ext.menu.Item({text:l('LBL_EXPORT_TO_PDF_BUTTON_LABEL'),icon:'modules/KReports/images/acrobat.png',handler:function(){aJ();},disabled:true});var az=new Ext.menu.Item({text:l('LBL_COMPARE_SNAPSHOTS_BUTTON_LABEL'),icon:'modules/KReports/images/chart_comparison.png',handler:function(){aT.show();},disabled:true});var aM=new Ext.menu.Item({text:l('LBL_BASIC_TRENDLINE_BUTTON_LABEL'),icon:'modules/KReports/images/trend_analysis.png',handler:function(){aU.show();},disabled:true});var addReportToFavorites=function(){Ext.Msg.prompt(l('LBL_FAVORITE_NAME'),l('LBL_FAVORITENAME_PROMPT'),function(f,text){if(f=='ok'){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=add_report_to_favorites',success:function(){removeFavoriteButton.show();addFavoriteButton.hide();},failure:function(){},params:{favorite_name:text,record:document.getElementById('recordid').value,whereConditions:D()}});}});};var addFavoriteButton=new Ext.Button({text:l('LBL_ADDTOFAVORITE_BUTTON_LABEL'),icon:'modules/KReports/images/add.png',handler:function(){addReportToFavorites();},hidden:true});var removeReportFromFavorites=function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=remove_report_from_favorites',success:function(){removeFavoriteButton.hide();addFavoriteButton.show();},failure:function(){},params:{record:document.getElementById('recordid').value}});};var removeFavoriteButton=new Ext.Button({text:l('LBL_REMOVEFAVORITE_BUTTON_LABEL'),icon:'modules/KReports/images/delete.png',handler:function(){removeReportFromFavorites();},hidden:true});var cY=function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=check_isfavorite',success:function(response,options){if(response.responseText=='true'){removeFavoriteButton.show();}else{addFavoriteButton.show();}},params:{record:document.getElementById('recordid').value}});};if(reportOptionsObject.showExport!=undefined&&reportOptionsObject.showExport==false)showExport=true;else showExport=false;if(reportOptionsObject.showSnapshots!=undefined&&reportOptionsObject.showSnapshots==false)showSnapshots=true;else showSnapshots=false;if(reportOptionsObject.showTools!=undefined&&reportOptionsObject.showTools==false)showTools=true;else showTools=false;var al=new Ext.Toolbar({renderTo:'toolbarArea',items:[{text:l('LBL_EDIT_BUTTON_LABEL'),icon:'modules/KReports/images/report_edit.png',handler:function(){var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='DetailView';form.action.value='EditView';form.submit();},id:'KReportsEditReportButton',disabled:true},{text:l('LBL_DELETE_BUTTON_LABEL'),icon:'modules/KReports/images/report_delete.png',handler:function(){Ext.MessageBox.confirm(l('LBL_DIALOG_CONFIRM'),l('LBL_DIALOG_DELETE_YN'),function(f){if(f=='yes'){var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='ListView';form.action.value='Delete';form.submit();}});},id:'KReportsDeleteReportButton',disabled:true},'-',addFavoriteButton,removeFavoriteButton,'-',{text:l('LBL_EXPORTMENU_BUTTON_LABEL'),icon:'modules/KReports/images/export.png',disabled:showExport,menu:{items:[{text:l('LBL_EXPORT_TO_EXCEL_BUTTON_LABEL'),icon:'modules/KReports/images/excel.png',handler:function(){var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='DetailView';form.action.value='export_to_excel';form.dynamicoptions.value=D();form.to_pdf.value='on';form.submit();form.to_pdf.value='';}},{text:l('LBL_EXPORT_TO_KLM_BUTTON_LABEL'),icon:'modules/KReports/images/map.png',handler:function(){exportToKML();},disabled:true},'-',bH,aC,'-',{text:l('LBL_EXPORT_TO_TARGETLIST_BUTTON_LABEL'),id:'KReportsAddTargetListButton',icon:'modules/KReports/images/targetlist.png',handler:function(){Ext.Msg.prompt(l('LBL_TARGETLIST_NAME'),l('LBL_TARGETLIST_PROMPT'),function(f,text){if(f=='ok'){ar.show();Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=export_to_targetlist',success:function(){ar.hide();},failure:function(){ar.hide();},params:{targetlist_name:text,record:document.getElementById('recordid').value,whereConditions:D()}});}});},disabled:true}]}},'-',{text:l('LBL_SNAPSHOTMENU_BUTTON_LABEL'),icon:'modules/KReports/images/snapshot.png',disabled:showSnapshots,menu:{items:[ak,'-',{text:l('LBL_SNAPSHOT_BUTTON_LABEL'),icon:'modules/KReports/images/snapshot.png',handler:function(){aP();}},'-',az,aM]}},'-',{text:l('LBL_TOOLSMENU_BUTTON_LABEL'),icon:'modules/KReports/images/tools.png',disabled:showTools,menu:{items:[{text:l('LBL_SCHEDULER_BUTTON'),icon:'modules/KReports/images/scheduler.png',handler:function(){fP();}},{text:'massupdate',icon:'modules/KReports/images/massupdate.png',handler:function(){fU();},disabled:true},{text:l('LBL_MASS_GEOCODE_BUTTON_LABEL'),icon:'modules/KReports/images/map.png',disabled:massGeoCodeDisabled,handler:function(){bl.show();Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=geocode_report_results',timeout:300000,success:function(){bl.hide();bk.removeAll();bk.load();reloadReportStore(D());},failure:function(){bl.hide();bk.removeAll();bk.load();reloadReportStore(D());},params:{record:document.getElementById('recordid').value,whereConditions:D()}});}},{text:l('LBL_SQL_BUTTON_LABEL'),icon:'modules/KReports/images/sql.png',handler:function(){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=get_sql',success:function(response,options){win=new Ext.Window({layout:'fit',width:500,height:300,closeAction:'hide',plain:true,title:l('LBL_SQL_BUTTON_LABEL'),items:new Ext.form.TextArea({value:response.responseText,readOnly:true}),buttons:[{text:'Close',handler:function(){win.hide();}}]});win.show(this);},params:{record:document.getElementById('recordid').value}});}},'-',{text:l('LBL_DUPLICATE_REPORT_BUTTON_LABEL'),id:'KReportsDuplicateReportButton',icon:'modules/KReports/images/copy.png',handler:function(){Ext.Msg.prompt(l('LBL_DUPLICATE_NAME'),l('LBL_DUPLICATE_PROMPT'),function(f,text){if(f=='ok'){Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=duplicate_report',params:{newName:text,record:document.getElementById('recordid').value}});}});},disabled:true}]}}]});dB();dm();cY();if(document.getElementById('kreporteredition').value=='premium')bH.enable();if(document.getElementById('haschart').value=='X'&&document.getElementById('kreporteredition').value=='premium')aC.enable();if(document.getElementById('haschart').value=='X'&&document.getElementById('kreporteredition').value=='premium')az.enable();if(document.getElementById('kreporteredition').value=='premium')aM.enable();if(document.getElementById('listtype').value=='')document.getElementById('listtype').value='standard';renderReport();var FC_Exported=function(){if(C<g){C++;var recordId=document.getElementById('recordid').value.replace(/-/g,'');var d=ac('kchart'+recordId+'index'+C);if(d.hasRendered())d.exportChart({exportFormat:'JPG',exportAction:'save'});}else{var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='DetailView';form.action.value='export_to_pdf';form.to_pdf.value='on';form.withchart.value='yes';form.submit();form.to_pdf.value='';form.withchart.value='no';}};var aN=function(){var K=document.getElementById('chart_layout').value.split('x');g=K[0]*K[1];C=1;var recordId=document.getElementById('recordid').value.replace(/-/g,'');var d=ac('kchart'+recordId+'index'+C);if(d.hasRendered())d.exportChart({exportFormat:'JPG',exportAction:'save'});};var aJ=function(){var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='DetailView';form.action.value='export_to_pdf';document.getElementById('to_pdf').value='on';document.getElementById('dynamicoptions').value=D();document.getElementById('withchart').value='no';form.submit();document.getElementById('to_pdf').value='';document.getElementById('withchart').value='no';};var exportToKML=function(){var form=document.getElementById('form');form.return_module.value='KReports';form.return_action.value='DetailView';form.action.value='export_to_kml';form.to_pdf.value='on';form.dynamicoptions.value=D();form.submit();form.to_pdf.value='';};});